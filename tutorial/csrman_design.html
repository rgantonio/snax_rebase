
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.2.11">
    
    
      
        <title>2. CSR Manager Design - SNAX Cluster</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#csr-manager" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="SNAX Cluster" class="md-header__button md-logo" aria-label="SNAX Cluster" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SNAX Cluster
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2. CSR Manager Design
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/KULeuven-MICAS/snitch_cluster/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    KULeuven-MICAS/snitch_cluster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="SNAX Cluster" class="md-nav__button md-logo" aria-label="SNAX Cluster" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SNAX Cluster
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KULeuven-MICAS/snitch_cluster/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    KULeuven-MICAS/snitch_cluster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/getting_started.html" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/directory_structure.html" class="md-nav__link">
        Repository Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/tutorial.html" class="md-nav__link">
        Old Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/documentation.html" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference Manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/snitch.html" class="md-nav__link">
        Snitch
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_2" type="checkbox" id="__nav_3_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_2">
          Snitch Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Snitch Cluster" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Snitch Cluster
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/snitch_cluster.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/peripherals.html" class="md-nav__link">
        Peripherals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schema-doc/snitch_cluster.html" class="md-nav__link">
        Schema
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/snax_cluster.html" class="md-nav__link">
        SNAX Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/reqrsp_interface.html" class="md-nav__link">
        Reqrsp Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/custom_instructions.html" class="md-nav__link">
        Custom Instructions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          SNAX Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SNAX Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          SNAX Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="architectural_overview.html" class="md-nav__link">
        Architectural Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="accelerator_design.html" class="md-nav__link">
        1. Accelerator Design
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="csrman_design.html" class="md-nav__link md-nav__link--active">
        2. CSR Manager Design
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="streamer_design.html" class="md-nav__link">
        3. Streamer Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="build_system.html" class="md-nav__link">
        4. Building the System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="programming.html" class="md-nav__link">
        5. Programming the System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="other_tools.html" class="md-nav__link">
        Other Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="summary_and_exercise.html" class="md-nav__link">
        Summary and Exercise
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../publications.html" class="md-nav__link">
        Publications
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/KULeuven-MICAS/snitch_cluster/edit/master/docs/tutorial/csrman_design.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="csr-manager">CSR Manager</h1>
<p>The <strong>(1) Control-Status Register (CSR) manager</strong> is a chisel-generated module to handle CSR transactions from the Snitch core to the accelerator. The accelerator only needs to comply with the CSR interface. The detailed diagram is shown below:</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snitch_cluster/assets/26665295/97af01e6-fcb0-48f7-880c-8bfdb1166308" /></p>
<p>There is a <strong>(2) <code>snax_csr_wrapper</code></strong> which is a wrapper to combine signals from the Chisel-generated module. As you will see later in <a href="#example-csr-generation">Example CSR Generation</a>, the Chisel-generated SNAX CSR Manager will have several unpacked signals. The purpose of the wrapper is to pack these signals and make it easier to connect to other modules. Section <a href="build_system.html">Building the System</a> has more details about the wrappers.</p>
<h1 id="csr-manager-interfaces">CSR Manager Interfaces</h1>
<p>There are two sides to the CSR interfaces. First is the <strong>(3) Snitch core interface</strong> that handles transactions between the CPU core and the CSR manager. You control these interfaces using RISCV CSR instructions. This will be discussed in the <a href="programming.html">Programming Your System</a> section.</p>
<p>There are two sets of channels, the request channel and the response channel. The request channel is where you specify a write or read request to the CSR manager. The response channels are the responses of the CSR manager to the Snitch core. Both channels use the decoupled interface (valid-ready protocol). Each request and response signal channels are tagged with <code>req</code> and <code>rsp</code> in the table below:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">signal name</th>
<th style="text-align: center;">channel type</th>
<th style="text-align: center;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">csr_req_addr_i[31:0]</td>
<td style="text-align: center;">req</td>
<td style="text-align: center;">Register address</td>
</tr>
<tr>
<td style="text-align: center;">csr_req_data_i[31:0]</td>
<td style="text-align: center;">req</td>
<td style="text-align: center;">Data to write unto the specified address</td>
</tr>
<tr>
<td style="text-align: center;">csr_req_write_i</td>
<td style="text-align: center;">req</td>
<td style="text-align: center;">Write/read signal: 1 = write, 0 = read</td>
</tr>
<tr>
<td style="text-align: center;">csr_req_valid_i</td>
<td style="text-align: center;">req</td>
<td style="text-align: center;">Transaction is valid</td>
</tr>
<tr>
<td style="text-align: center;">csr_req_ready_o</td>
<td style="text-align: center;">req</td>
<td style="text-align: center;">CSR manager is ready to accept transactions</td>
</tr>
<tr>
<td style="text-align: center;">csr_rsp_data_o[31:0]</td>
<td style="text-align: center;">rsp</td>
<td style="text-align: center;">Data in response to reads</td>
</tr>
<tr>
<td style="text-align: center;">csr_rsp_valid_o</td>
<td style="text-align: center;">rsp</td>
<td style="text-align: center;">Response data is valid</td>
</tr>
<tr>
<td style="text-align: center;">csr_rsp_ready_i</td>
<td style="text-align: center;">rsp</td>
<td style="text-align: center;">Core side is ready to accept transactions</td>
</tr>
</tbody>
</table>
<p>The second side is the <strong>(4) accelerator datapath interface</strong>. The CSR manager sends the configurations of the read-write (RW) registers through a decoupled interface. However, the accelerator may have read-only (RO) registers that are meant for status monitoring. These are directly wired from the accelerator toward the CSR manager but without the need for a decoupled interface. When a user reads one of the RO registers, the CSR manager directly transmits the wired RO signals to the response ports. The table below describes these signals:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">signal name</th>
<th style="text-align: center;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">csr_reg_rw_set_o [NumRwCsr][31:0]</td>
<td style="text-align: center;">Packed RW configurations to send to accelerator</td>
</tr>
<tr>
<td style="text-align: center;">csr_reg_set_valid_o</td>
<td style="text-align: center;">Configurations are valid</td>
</tr>
<tr>
<td style="text-align: center;">csr_reg_set_ready_i</td>
<td style="text-align: center;">Accelerator side is ready to accept configurations</td>
</tr>
<tr>
<td style="text-align: center;">csr_reg_ro_set_i [NumRoCsr][31:0]</td>
<td style="text-align: center;">Packed RO register data</td>
</tr>
</tbody>
</table>
<p>The <code>NumRwCsr</code> and <code>NumRoCsr</code> pertain to the number of RW and RO registers, respectively. These are design-time parameters that we configure for the CSR manager. See section <a href="#configuring-the-generated-csr-manager">Configuring the Generated CSR Manager</a></p>
<h1 id="csr-manager-features-for-snax-alu">CSR Manager Features for SNAX ALU</h1>
<p>The CSR manager has a set of read-write (RW) registers and read-only (RO) registers. Our CSR manager has a mechanism that bulk transfers a set of configurations to the main accelerator. The last RW register is always the start signal to transact all configurations into the accelerator. The figure below demonstrates this:</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snax_cluster/assets/26665295/72743450-30ff-4a6f-a08b-5096c38af24d" /></p>
<p>In our <a href="accelerator_design.html">SNAX ALU accelerator</a>, we have 2 main configuration RW registers: the mode and the data length to process. The 3rd RW register is the start that sends the configured settings to the accelerator data path. It is only when you assert the LSB of the last RW register (which we named the start register) that the CSR manager transacts all configurations to the accelerator.</p>
<p>When the accelerator is not available to accept configuration transactions, the CSR holds the last transaction until it is successful. The timing diagram below shows this:</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snax_cluster/assets/26665295/e22d6a11-123f-4928-ae68-f0212e6465c0" /></p>
<p>The CSR manager is useful for double buffering. For example, when an accelerator is already processing an old configuration, the Snitch core can already configure new settings. This does not overwrite the old configuration. This is particularly useful in hiding CSR setup cycles because we can set up configurations while the accelerator is running.</p>
<p>The RO registers are read-only registers that the CSR manager can read from. These are mostly used for monitoring purposes like status or performance counters. The addresses of the RO registers are immediately after the RW registers. For example, the register table in <a href="accelerator_design.html">Accelerator Design</a> is copied below. Observe that all RO registers are after the RW registers.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">register name</th>
<th style="text-align: center;">register offset</th>
<th style="text-align: center;">type</th>
<th style="text-align: center;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">mode</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">RW</td>
<td style="text-align: center;">Operating modes: 0 - add, 1 - sub, 2 - mul, 3 - XOR</td>
</tr>
<tr>
<td style="text-align: center;">length</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RW</td>
<td style="text-align: center;">Number of elements to process</td>
</tr>
<tr>
<td style="text-align: center;">start</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">RW</td>
<td style="text-align: center;">Set 1 to LSB only to start the accelerator</td>
</tr>
<tr>
<td style="text-align: center;">busy</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">Busy status. 1 - busy, 0 - idle</td>
</tr>
<tr>
<td style="text-align: center;">perf. counter</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">RO</td>
<td style="text-align: center;">Performance counter indicating number of cycles</td>
</tr>
</tbody>
</table>
<h1 id="configuring-the-generated-csr-manager">Configuring the Generated CSR Manager</h1>
<p>You only need to specify the number of RW and RO registers of the CSR manager in the <code>snax-alu.hjson</code> configuration file. The snippet below shows the <code>snax_acc_cfg</code> dictionary:</p>
<div class="highlight"><pre><span></span><code>snax_acc_cfg: {
    snax_acc_name: &quot;snax_alu&quot;
    snax_tcdm_ports: 16,
    snax_num_rw_csr: 3,
    snax_num_ro_csr: 2,
    snax_streamer_cfg: {$ref: &quot;#/snax_alu_streamer_template&quot; }
},
</code></pre></div>
<p>The <code>snax_num_rw_csr</code> sets the number of RW CSRs while the <code>snax_num_ro_csr</code> sets the number of RO CSRs. These settings go into our accelerator wrapper script to generate Chisel parameters for generation. Then it automatically generates the CSR manager and stores it under the <code>./target/snitch_cluster/generated/snax_alu/</code> directory. See <a href="build_system.html">Building the System</a> for more details later.</p>
<h1 id="example-csr-generation">Example CSR Generation</h1>
<p>This is a good time to test our wrapper generation and see the changes in the CSR manager. More details about the wrapper generation are in the <a href="build_system.html">Building the System</a> section. Do the following (this assumes that you are running within the container):</p>
<p>1 - Go to the root directory.</p>
<p>2 - Run the command:</p>
<p>If you are working in Codespaces:</p>
<div class="highlight"><pre><span></span><code>/workspaces/snax_cluster/util/wrappergen/wrappergen.py --cfg_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/target/snitch_cluster/cfg/snax-alu.hjson&quot;</span> --tpl_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/hw/templates/&quot;</span> --chisel_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/hw/chisel/&quot;</span> --gen_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/target/snitch_cluster/generated/&quot;</span>
</code></pre></div>
<p>If you are working in a docker container:</p>
<div class="highlight"><pre><span></span><code>/repo/util/wrappergen/wrappergen.py --cfg_path<span class="o">=</span><span class="s2">&quot;/repo/target/snitch_cluster/cfg/snax-alu.hjson&quot;</span> --tpl_path<span class="o">=</span><span class="s2">&quot;/repo/hw/templates/&quot;</span> --chisel_path<span class="o">=</span><span class="s2">&quot;/repo/hw/chisel/&quot;</span> --gen_path<span class="o">=</span><span class="s2">&quot;/repo/target/snitch_cluster/generated/&quot;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are working outside of the container or Codespace, note that the <code>/repo</code> or <code>/workspaces/snax_cluster/</code> pertains to the root of the repository.</p>
</div>
<p>3 - Wait a while since this generates the CSR manager, streamer, and all other wrappers.</p>
<p>4 - When finished, navigate to <code>./target/snitch_cluster/generated/snax_alu/</code></p>
<p>5 - Open the file <code>snax_alu_csrman_CsrManager.sv</code>. This is the Chisel-generated file. It looks like a synthesized netlist. All modules required for the CSR manager are declared in this file. </p>
<p>6 - Find the top module <code>snax_alu_csrman_CsrManager</code> within the <code>snax_alu_csrman_CsrManager.sv</code> file. Can you identify the signals discussed in this section?</p>
<details>
  <summary> Which are the interfaces towards the Snitch core? </summary>
  All signals with `*_csr_config_in_*`.
</details>

<details>
  <summary> Which are the interfaces for the accelerator side? </summary>
  All signals with `*_csr_config_out_*` and also the `*_read_only_csr_*`.
</details>

<details>
  <summary> How many ports are generated for the RW and RO registers? </summary>
  There are 3 RW register ports and 2 RO register ports.
</details>

<p>7 - Find the generated wrapper <code>snax_alu_csrman_wrapper.sv</code>. Can you identify the following?</p>
<details>
  <summary> Can you see where the SNAX CSR manager is instanced? </summary>
  Yes! It has the instance name `i_snax_alu_csrman_CsrManager`.
</details>

<details>
  <summary> Can you tell what the SNAX CSR wrapper is trying to fix? </summary>
  It's just simply packing the unpacked Chisel-generated signals of the CSR manager.
</details>

<h1 id="try-modifying-csr-manager-yourself">Try Modifying CSR Manager Yourself!</h1>
<p>1 - Modify the number of RW and RO registers with the <code>snax_num_rw_csr</code> and <code>snax_num_ro_csr</code> parameters in the <code>snax-alu.hjson</code> file.</p>
<p>2 - Then re-generate again and see what changes are in both the Chisel-generated file and the wrapper file.</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="accelerator_design.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 1. Accelerator Design" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              1. Accelerator Design
            </div>
          </div>
        </a>
      
      
        
        <a href="streamer_design.html" class="md-footer__link md-footer__link--next" aria-label="Next: 3. Streamer Design" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              3. Streamer Design
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.748e2769.min.js"></script>
      
    
  </body>
</html>