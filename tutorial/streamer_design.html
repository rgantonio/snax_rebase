
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.2.11">
    
    
      
        <title>3. Streamer Design - SNAX Cluster</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.9647289d.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#streamer" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="SNAX Cluster" class="md-header__button md-logo" aria-label="SNAX Cluster" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SNAX Cluster
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3. Streamer Design
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/KULeuven-MICAS/snitch_cluster/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    KULeuven-MICAS/snitch_cluster
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="SNAX Cluster" class="md-nav__button md-logo" aria-label="SNAX Cluster" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SNAX Cluster
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KULeuven-MICAS/snitch_cluster/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    KULeuven-MICAS/snitch_cluster
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/getting_started.html" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/directory_structure.html" class="md-nav__link">
        Repository Structure
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/tutorial.html" class="md-nav__link">
        Old Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ug/documentation.html" class="md-nav__link">
        Documentation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Reference Manual
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference Manual" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Reference Manual
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/snitch.html" class="md-nav__link">
        Snitch
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_2" type="checkbox" id="__nav_3_1_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1_2">
          Snitch Cluster
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Snitch Cluster" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_2">
          <span class="md-nav__icon md-icon"></span>
          Snitch Cluster
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/snitch_cluster.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/peripherals.html" class="md-nav__link">
        Peripherals
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../schema-doc/snitch_cluster.html" class="md-nav__link">
        Schema
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/snax_cluster.html" class="md-nav__link">
        SNAX Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/reqrsp_interface.html" class="md-nav__link">
        Reqrsp Interface
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../rm/custom_instructions.html" class="md-nav__link">
        Custom Instructions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          SNAX Tutorial
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SNAX Tutorial" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          SNAX Tutorial
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="introduction.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="architectural_overview.html" class="md-nav__link">
        Architectural Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="accelerator_design.html" class="md-nav__link">
        1. Accelerator Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="csrman_design.html" class="md-nav__link">
        2. CSR Manager Design
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="streamer_design.html" class="md-nav__link md-nav__link--active">
        3. Streamer Design
      </a>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="build_system.html" class="md-nav__link">
        4. Building the System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="programming.html" class="md-nav__link">
        5. Programming the System
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="other_tools.html" class="md-nav__link">
        Other Tools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="summary_and_exercise.html" class="md-nav__link">
        Summary and Exercise
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../publications.html" class="md-nav__link">
        Publications
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/KULeuven-MICAS/snitch_cluster/edit/master/docs/tutorial/streamer_design.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<h1 id="streamer">Streamer</h1>
<p>The SNAX streamer is a Chisel-generated module to help streamline the data delivery from memory to the accelerator and vice versa. There is a <a href="../../hw/chisel/doc/streamer.md">detailed streamer documentation</a>, but in this tutorial section, we will only cover the high-level aspects and how to configure the streamer.</p>
<h1 id="why-do-we-need-a-streamer">Why Do We Need a Streamer?</h1>
<p>Accelerators attain peak performance when data continuously streams into them; otherwise, they spend cycles waiting for data availability. Delays often occur due to mismatched data arrangements in shared memory or congestion among accelerators accessing the same banks concurrently.</p>
<p>It's crucial to differentiate between the data layout in memory and the access pattern of an accelerator. The figure below shows two data layouts and how an accelerator would get the data. </p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snax_cluster/assets/26665295/8c359652-01e2-4e9e-a519-a0c76daa1b0a" /></p>
<p>The memory address on the top-right corner is a guide to show the addresses of each data element. Assume each column represents a separate memory bank and each block signifies a data element, with each bank having only one read and one write access port.</p>
<p>The data layout refers to the arrangement of data contents in memory, while the access pattern pertains to how accelerators retrieve data from memory, such as contiguous or strided access.</p>
<p>On the left of the figure, the data layout in memory organizes the inputs and outputs on each bank. The accelerator's data access needs to be configured to access data continuously with appropriate memory address strides pointing to the memory addresses.</p>
<p>For example, if the data is arranged in data layout 1, input A needs to get data in addresses <code>[0, 4, 8, 12]</code> and in the exact order. That means the starting <code>base_address_a=0</code> and skip counts with <code>temporal_stride_a=4</code>. The <code>target_address_a</code> is computed in a simple loop:</p>
<div class="highlight"><pre><span></span><code>for(i = 0; i &lt; 4; i++):
  target_address_a = base_address_a + temporal_stride_a*i;
</code></pre></div>
<p>Another arrangement in data layout 2 shows that the data can be arranged contiguously. This time, input A accesses the data in the address sequence <code>[0,1,2,3]</code>. Here we set <code>base_address_a=0</code> and <code>temporal_stride_a=1</code>.</p>
<p>A more complicated example is when a streamer can get multiple data in parallel. This necessitates that we need to also have an address generation that can do spatial parallelism. Particularly it would be convenient to provide a base address and a stride but have all other ports automatically increment per accelerator port. The figure below shows an example accelerator that takes in 3 inputs in parallel and also produces 3 outputs in parallel:</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snax_cluster/assets/26665295/f4b23a99-0125-4f3e-9c30-85f799545d28" /></p>
<p>Consider the data layout 1. Each port of the accelerator needs to compute the target address as:</p>
<div class="highlight"><pre><span></span><code>for(i = 0; i &lt; 4; i++):
  target_address_a[0] = base_address_a + temporal_stride_a*i;
  target_address_a[1] = base_address_a + temporal_stride_a*i + 1;
  target_address_a[2] = base_address_a + temporal_stride_a*i + 2;
</code></pre></div>
<p>Where each <code>target_address_a[i]</code> pertains to the address of one port. Here, <code>base_address_a=0</code> and <code>temporal_stride_a=12</code>. Note that the temporal stride is different to accommodate the new memory addressing. Equivalently, we can also rewrite this with another loop and call it a <code>parfor</code> loop.</p>
<div class="highlight"><pre><span></span><code>for(i = 0; i &lt; 4; i++):
  # Parfor equivalent
  parfor(j = 0; j &lt; 3; j++):
    target_address_a[j] = base_address_a + temporal_stride_a*i + spatial_stride_i*j;
</code></pre></div>
<p>We also define a <code>spatial_stride</code> to indicate the "skip-count" in the spatial dimension. For data layout 1 we use <code>spatial_stride_a=1</code>. Thus the equivalent sequences per port are:</p>
<div class="highlight"><pre><span></span><code>target_address_a[0] = [0,12,24,36]
target_address_a[1] = [1,13,25,37]
target_address_a[2] = [2,14,26,38]
</code></pre></div>
<p>More specifically, in cycle 1, the addresses 0, 1, and 2 are generated. In cycle 2, the addresses 12, 13, 14 are generated, and so on.</p>
<p>This spatial stride is useful for parallel accesses. For example, accessing data for data layout 2 can be expressed using the same for loop but with <code>spatial_stride_a=2</code>. This results in the sequences below:</p>
<div class="highlight"><pre><span></span><code>target_address_a[0] = [0,12,24,36]
target_address_a[1] = [2,14,26,38]
target_address_a[2] = [4,16,28,40]
</code></pre></div>
<p>Another example in data layout 3 shows that data is placed semi-contiguously in memory. To get the data in this manner, we need a second temporal loop bound. Such that:</p>
<div class="highlight"><pre><span></span><code>for(i = 0; i &lt; 2; i++):
  for(j = 0; j &lt;2; j++):
    # Parfor equivalent
    parfor(k = 0; k &lt; 3; k++):
      target_address_a[k] = base_address_a + temporal_stride_a_i*i + temporal_stride_a_j*j + spatial_stride_i*k;
</code></pre></div>
<p>Where <code>temporal_stride_a_i</code> is the stride for the outer temporal loop bound and <code>temporal_stride_a_j</code> is the stride for the inner temporal loop bound. We can set <code>temporal_stride_a_i=12</code> and <code>temporal_stride_a_j=3</code> to access data of data layout 3. This results in a sequence:</p>
<div class="highlight"><pre><span></span><code>target_address_a[0] = [0,3,12,15]
target_address_a[1] = [1,4,13,16]
target_address_a[2] = [2,5,14,17]
</code></pre></div>
<p>Because data can be arranged differently in memory, a streamer becomes useful for configuring how to access that data. To alleviate the burden of an accelerator designer on building their streamer, we provide a design- and run-time configurable streamer, as will be shown in the section <a href="#configuring-the-generated-streamer">Configuring the Generated Streamer</a>. </p>
<h1 id="flexible-strided-address-generation">Flexible Strided Address Generation</h1>
<p>As discussed above, it is crucial to provide support for accelerators to access data in various places. Our SNAX streamer solves this through a flexible strided address generation. We can generalize the address generation for one input or output port with the pseudo-code below:</p>
<div class="highlight"><pre><span></span><code>for(tb_n_1 = 0; tb_n_1 &lt; temporal_bound[n-1]; tb_n_1++)
  for(tb_n_2 = 0; tb_n_2 &lt; temporal_bound[n-2]; tb_n_2++)
   …
    for(tb_0 = 0; tb_0 &lt; temporal_bound[0]; tb_0++)
     parfor(sb_m_1 = 0; sb_m_1 &lt; spatial_bound[m-1]; sb_m_1++)
      parfor(sb_m_1 = 0; sb_m_2 &lt; spatial_bound[m-2]; sb_m_1++)
       …
        parfor(sb_0 = 0; sb_0 &lt; spatial_bound[0]; sb_0++)

          temporal_address = tb_n_1*temporal_stride[n-1] + tb_n_2*temporal_stride[n-2] + ... +
                             tb_1*temporal_stride[1] + tb_1*temporal_stride[0]

          spatial_address = sb_n_1*spatial_stride[n-1] + sb_n_2*spatial_stride[n-2] + ... +
                            sb_1*spatial_stride[1] + sb_0*spatial_stride[0]

          target_address = base_address + temporal_address + spatial_address
</code></pre></div>
<p>Where <code>temporal_bound[*]</code> pertains to the bounds of the temporal loops and <code>tb_*</code> pertains to the temporal indices. The <code>spatial_bound[*]</code> pertains to the bounds of the spatial loops and <code>sb_*</code> pertains to the spatial indices. Group them according to <code>temporal_address</code> and <code>spatial_address</code> and add them to the <code>base_address</code> which results in the <code>target_address</code>.</p>
<p>The <code>temporal_bound[*]</code>, <code>tb_*</code>, and <code>sb_*</code> are run-time configurable. The number of the temporal loops and <code>sb_*</code> is design-time configurable.</p>
<p>The strided address generation is the working principle of the SNAX streamer. With this, we can flexibly access data in various places of the memory. </p>
<h1 id="streamer-microarchitecture">Streamer Microarchitecture</h1>
<p>The figure below shows a more detailed architecture of the streamer. The <strong>(1) streamer</strong> sits between the TCDM interconnect and the accelerator as a flexible and efficient data movement unit. There is also a <strong>(2) streamer wrapper</strong> to re-wire the Chisel-generated signals. More details of the wrappers are in the <a href="build_system.html">Building the System</a> section.</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snitch_cluster/assets/26665295/e26af3c9-43f8-4de5-b07e-02dbacecc9fd" /></p>
<h2 id="streamer-interfaces">Streamer Interfaces</h2>
<h3 id="3-tcdm-interface"><strong>(3) TCDM interface</strong></h3>
<p>The <strong>TCDM interface</strong> has request and response channels and uses a decoupled interface. The table below describes the details of the request and response channels:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">signal name</th>
<th style="text-align: center;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">tcdm_req_addr_o</td>
<td style="text-align: center;">Target address in memory.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_data_o</td>
<td style="text-align: center;">Data to write in memory.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_write_o</td>
<td style="text-align: center;">Write enable signal. 1 = write, 0 = read.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_strb_o</td>
<td style="text-align: center;">Byte strobe.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_core_id_o</td>
<td style="text-align: center;">Core ID. Currently unused.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_is_core_o</td>
<td style="text-align: center;">Request from core.       Currently unused.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_valid_o</td>
<td style="text-align: center;">Request channel is valid.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_req_ready_i</td>
<td style="text-align: center;">Request channel is ready.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_rsp_data_i</td>
<td style="text-align: center;">Response data coming from memory.</td>
</tr>
<tr>
<td style="text-align: center;">tcdm_rsp_valid_i</td>
<td style="text-align: center;">Response data is valid.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of the signals are currently unused by the streamer. However, we needed to comply with the TCDM IP of the Snitch platform.</p>
</div>
<p>The response channel only has a <code>valid</code> signal but no <code>ready</code> signal. The TCDM assumes that the receiving end will always be ready. The streamer automatically handles these response data through FIFO buffers and makes sure no more new request is sent unless there is idle space to store the new responses.</p>
<h3 id="4-accelerator-interface">(4) Accelerator Interface</h3>
<p>The accelerator interface connects the streamer to the accelerator. It only has a single data channel with a decoupled interface. There are two directions. We have the <code>acc2stream</code> and <code>stream2acc</code> interfaces which pertain to writing and reading directions, respectively. This means that <code>acc2stream</code> ports will always be for write directions only and <code>stream2acc</code> will always be for read directions only.</p>
<h2 id="streamer-submodules">Streamer Submodules</h2>
<h3 id="5-data-movers">(5) Data Movers</h3>
<p>The core of the streamers are the data movers which handle all write or read transactions. Each mover contains a <em>data mover</em> for handling transactions with the TCDM interconnect, FIFO buffers for handling transactions with the accelerator, and an <em>Address Generation Unit</em> (AGU) for providing the strided address generation to the data mover.</p>
<p>We can also configure several settings for the streamers. This includes a number of read-and-write data movers, the depth of the FIFOs, and even the data widths to use for each accelerator port. These are design-time parameters. The section <a href="#configuring-the-generated-streamer">Configuring the Generated Streamer</a> will demonstrate how to configure these.</p>
<h3 id="6-streamer-csr-manager">(6) Streamer CSR Manager</h3>
<p>The streamer has its own <em>(5) streamer CSR manager</em> which functions the same way as the <a href="csrman_design.html">CSR Manager</a> for the accelerator. Therefore, it has its own set of registers that are mainly used for the strided address generation.</p>
<p>The number of registers varies depending on the configured parameters in the configuration file. The section <a href="#configuring-the-generated-streamer">Configuring the Generated Streamer</a> talks more about how the configuration file generates the registers. For now, it is important to understand the general set of registers that exist in the CSR manager. The table below shows the list of registers with their corresponding type and description.</p>
<table>
<thead>
<tr>
<th style="text-align: center;">register name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">temporal loop bounds</td>
<td style="text-align: left;">RW</td>
<td style="text-align: left;">Temporal loop bound for each temporal dimension. Can be more than 1 depending on several loop bounds indicated.</td>
</tr>
<tr>
<td style="text-align: center;">temporal loop strides</td>
<td style="text-align: left;">RW</td>
<td style="text-align: left;">Temporal loop strides for each temporal dimension. Can be more than 1 depending on the number of data movers.</td>
</tr>
<tr>
<td style="text-align: center;">spatial loop strides</td>
<td style="text-align: left;">RW</td>
<td style="text-align: left;">Spatial loop strides for each data mover for corresponding spatial dimension. The spatial dimension for each data mover can be different. It depends on the accelerator.</td>
</tr>
<tr>
<td style="text-align: center;">base pointer</td>
<td style="text-align: left;">RW</td>
<td style="text-align: left;">Base pointer for each data mover</td>
</tr>
<tr>
<td style="text-align: center;">start streamer</td>
<td style="text-align: left;">RW</td>
<td style="text-align: left;">This is the last RW register to transfer configurations to the actual streamer CSRs.</td>
</tr>
<tr>
<td style="text-align: center;">performance counter</td>
<td style="text-align: left;">RO</td>
<td style="text-align: left;">Single performance counter which tracks how many cycles the streamer ran.</td>
</tr>
</tbody>
</table>
<h1 id="configuring-the-generated-streamer">Configuring the Generated Streamer</h1>
<p>There are two things to consider when we configure the streamers: first is the microarchitecture and second are the CSR registers that it generates. It is important to configure the streamer to what your accelerator needs.</p>
<h2 id="snax-alu-streamer-microarchitecture">SNAX ALU Streamer Microarchitecture</h2>
<p>For our SNAX ALU accelerator, we want the streamer to have the microarchitecture shown in the figure below:</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snitch_cluster/assets/26665295/156e30c3-c682-4f01-b801-fee5ba7bb139" /></p>
<p>Some notable characteristics:
- We need two reader ports each with a data width that is 256 bits wide. We also want to use 8 FIFO buffers for each reader port. The SNAX ALU will have 4 PEs in parallel each taking in 64 bits of data in each PE. Hence, the a need for a 256-bit wide reader port.
- We need one writer port with a data width of 512 bits and uses 8 FIFO buffers. The SNAX ALU output is double the data width: 128 bits per port of a PE and hence with 4 PEs results in 512 bits-wide write port.
- We only need one temporal loob bound for this streamer. 
- The general strided address generation for this streamer is:</p>
<div class="highlight"><pre><span></span><code>for(i = 0; i &lt; N; i++):
  # Parfor equivalent
  parfor(j = 0; j &lt; 4; j++):
    target_address_a[j] = base_address_a + temporal_stride_a*i + spatial_stride_i*j;
</code></pre></div>
<h2 id="snax-alu-streamer-configuration">SNAX ALU Streamer Configuration</h2>
<p>Recall that from the <code>snax-alu.hjson</code>, the <code>snax_acc_cfg</code> contains a <code>snax_streamer_cfg</code> which references a streamer template. The <code>snax_acc_cfg</code> is shown below for reference:</p>
<div class="highlight"><pre><span></span><code>snax_acc_cfg: {
  snax_acc_name: &quot;snax_alu&quot;
  snax_module: &quot;snax_alu_wrapper&quot;,
  snax_tcdm_ports: 16,
  snax_num_rw_csr: 3,
  snax_num_ro_csr: 2,
  snax_streamer_cfg: {$ref: &quot;#/snax_alu_streamer_template&quot; }
},
</code></pre></div>
<p>If you scroll down to the bottom of the configuration file, you should see the <code>snax_alu_streamer_template</code> dictionary set. This template describes the streamer configurations. Let's go through each component.</p>
<p>The <code>temporal_addrgen_unit_params</code> component with <code>loop_dim</code> generates the number of temporal loop bounds. Since it's just 1, then we only have 1 temporal loop bound.</p>
<div class="highlight"><pre><span></span><code>temporal_addrgen_unit_params: {
  loop_dim: 1,
}
</code></pre></div>
<p>The <code>fifo_reader_params</code> and <code>fifo_writer_params</code> configure the FIFOs. Take note that the FIFOs are directly connected to the accelerator interface. It consists of the <code>fifo_width</code> which configures the datawidth of the accelerator interface ports. It also has the FIFO depths <code>fifo_depth</code> which configures the depth of the FIFOs.</p>
<div class="highlight"><pre><span></span><code>fifo_reader_params: {
  fifo_width: [256, 256],
  fifo_depth: [8, 8],
}

fifo_writer_params: {
  fifo_width: [512],
  fifo_depth: [8],
}
</code></pre></div>
<p>The <code>data_reader_params</code> and <code>data_writer_params</code> effectively configure the TCDM interface ports. It consists of <code>tcdm_ports_num</code> which controls how many TCDM ports are needed. The <code>spatial_bounds</code> pertain to the spatial unrolling factors (your parfor) for each data mover. The <code>spatial_dim</code> is the dimension of spatial unrolling factors (your parfor) for each data mover. The <code>element_width</code> is the single data element width for each data mover, useful for generating spatial addresses.</p>
<div class="highlight"><pre><span></span><code>data_reader_params:{
  tcdm_ports_num: [4, 4],
  spatial_bounds: [[4], [4]],
  spatial_dim: [1,1],
  element_width: [64,64],
}

data_writer_params:{
  tcdm_ports_num: [8],
  spatial_bounds: [[8]],
  spatial_dim: [1],
  element_width: [64],
}
</code></pre></div>
<p>The number of elements in a list pertains to how many data movers there are. For example, there are 2 elements in the <code>data_reader_params</code> and therefore it instantiates two read data movers. There is only 1 element in the <code>data_writer_params</code> and hence only instantiates 1 write data mover.</p>
<p>Finally, there is the <code>stationarity</code> configuration which is for stationarity for each data mover. If the stationarity bit is set, the innermost loop for that data mover is set to 1. This does not instantiate anything but rather affects the loop bound for a data mover. It only fixes the loop bound to 1. This is a special case scenario only, such as for output-stationary or weight-stationary accelerators. In the SNAX ALU, this is 0. </p>
<h2 id="snax-alu-streamer-csrs">SNAX ALU Streamer CSRs</h2>
<p>Based on the configuration file we expect the CSR registers to have:</p>
<ul>
<li>1 register for a single loop bound as specified in the <code>temporal_addrgen_unit_params -&gt; loop_dim = 1</code>. If the number is 2 then we would have 2 loop bounds.</li>
<li>3 temporal stride registers, 3 spatial stride registers, and 3 base address pointers since we have 3 data movers in total (2 read data movers and 1 write data mover).</li>
<li>1 start register to start the streamer.</li>
<li>1 performance counter register for how many cycles the streamer was active.</li>
</ul>
<p>Below is a tabulated version of the CSRs of the streamers with the register offset addresses, type, and description:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">register name</th>
<th style="text-align: center;">register offset</th>
<th style="text-align: center;">type</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">temporal loop bound</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal loop bound for address generation</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for input A</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for input B</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for output OUT</td>
</tr>
<tr>
<td style="text-align: center;">spatial stride 0</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Spatial stride for input A</td>
</tr>
<tr>
<td style="text-align: center;">spatial stride 1</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Spatial stride for input B</td>
</tr>
<tr>
<td style="text-align: center;">spatial stride 2</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Spatial stride for output OUT</td>
</tr>
<tr>
<td style="text-align: center;">base addr 0</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Base address for input A</td>
</tr>
<tr>
<td style="text-align: center;">base addr 1</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Base address for input B</td>
</tr>
<tr>
<td style="text-align: center;">base addr 2</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Base address for output OUT</td>
</tr>
<tr>
<td style="text-align: center;">start</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Start register to send configurations and start streaming</td>
</tr>
<tr>
<td style="text-align: center;">perf. counter</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">RO</td>
<td style="text-align: left;">Performance counter indicating the number of cycles ran</td>
</tr>
</tbody>
</table>
<h1 id="example-streamer-generation">Example Streamer Generation</h1>
<p>This is a good time to test our wrapper generation and see the changes in the Streamer. More details about the wrapper generation are in the <a href="build_system.html">Building the System</a> section. Do the following:</p>
<p>1 - Go to the root directory.</p>
<p>2 - Run the command:</p>
<p>If you are working in Codespaces:</p>
<div class="highlight"><pre><span></span><code>/workspaces/snax_cluster/util/wrappergen/wrappergen.py --cfg_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/target/snitch_cluster/cfg/snax-alu.hjson&quot;</span> --tpl_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/hw/templates/&quot;</span> --chisel_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/hw/chisel/&quot;</span> --gen_path<span class="o">=</span><span class="s2">&quot;/workspaces/snax_cluster/target/snitch_cluster/generated/&quot;</span>
</code></pre></div>
<p>If you are working in a docker container:</p>
<div class="highlight"><pre><span></span><code>/repo/util/wrappergen/wrappergen.py --cfg_path<span class="o">=</span><span class="s2">&quot;/repo/target/snitch_cluster/cfg/snax-alu.hjson&quot;</span> --tpl_path<span class="o">=</span><span class="s2">&quot;/repo/hw/templates/&quot;</span> --chisel_path<span class="o">=</span><span class="s2">&quot;/repo/hw/chisel/&quot;</span> --gen_path<span class="o">=</span><span class="s2">&quot;/repo/target/snitch_cluster/generated/&quot;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are working outside of the container, note that the <code>/repo</code> pertains to the root of the repository.</p>
</div>
<p>3 - Wait a while since this generates the CSR manager, streamer, and all other wrappers.</p>
<p>4 - When finished, navigate to <code>./target/snitch_cluster/generated/snax_alu/</code></p>
<p>5 - Open the file <code>snax_alu_streamer_StreamerTop.sv</code>. This is the Chisel-generated file. It looks like a synthesized netlist. All modules required for the streamer are declared in this file. </p>
<p>6 - Find the top module <code>snax_alu_streamer_StreamerTop</code> within the <code>snax_alu_streamer_StreamerTop.sv</code> file. Can you identify the signals discussed in this section?</p>
<details>
  <summary> Which are the interfaces for the accelerator side? </summary>
  All signals with `*_streamer2accelerator_*` and `*_accelerator2streamer_*` in their signal names.
</details>

<details>
  <summary> Can you identify which are for the write and read ports on the accelerator side? </summary>
  Signals with `*_streamer2accelerator_*` are for read ports and signals with `*_accelerator2streamer_*` are for write ports.
</details>

<details>
  <summary> How many are for write ports and how many are for read ports? </summary>
  There are 2 read ports (`*_streamer2accelerator_*`) and 1 write port (`*_accelerator2streamer_*`).
</details>

<details>
  <summary> Which are the interfaces for the TCDM side? </summary>
  All signals with `*_tcdm_*` in their signal names.
</details>

<details>
  <summary> How many TCDM ports are there? </summary>
  16 TCDM ports for both request and response channels.
</details>

<p>7 - In the same <code>snax_alu_streamer_StreamerTop.sv</code> file find the <code>snax_alu_streamer_CsrManager</code> module. This is the CSR manager of the streamer.</p>
<details>
  <summary> Can you verify and count how many RW and RO ports there are? </summary>
  Referring to the table above, there should be 11 RW ports and 1 RO port. In the streamer's CSR manager it shows only 10 but the 11 is just not outputted. There is only 1 RO port.
</details>

<details>
  <summary> Why do you think the start register is missing in the listed ports? </summary>
  Because it only sends the register set configuration to the accelerator data path.
</details>

<details>
  <summary> Which register offset do you think pertains to the spatial stride for input A? </summary>
  Referring to the table above, it should be number 4.
</details>

<p>8 - Find the generated wrapper <code>snax_alu_streamer_wrapper.sv</code>. </p>
<details>
  <summary> Can you see where the Chisel-generated streamer is instanced? </summary>
  Yes! It should be with the instance name `i_snax_alu_streamer_top`.
</details>

<details>
  <summary> Can you tell what the SNAX streamer wrapper is trying to fix? </summary>
  It's basically repacking the unpacked signals of the Chisel-generated file into packed signals for easy integration in System Verilog.
</details>

<h1 id="try-modifying-the-streamer">Try Modifying the Streamer!</h1>
<p>Let's try a simple exercise but we will spoil the answer to you already. Suppose we want the following streamer characteristics:</p>
<ul>
<li>2 temporal loop bounds</li>
<li>1 reader and 1 writer that takes in 8 parallel inputs (and outputs) each 64 bits wide and with a FIFO depth of 16.</li>
<li>8 TCDM ports for each reader and writer.</li>
</ul>
<p>The configuration streamer template should look like this:</p>
<p><div class="highlight"><pre><span></span><code>snax_test_template :{

  temporal_addrgen_unit_params: {
    loop_dim: 2,
  }

  fifo_reader_params: {
    fifo_width: [512],
    fifo_depth: [16],
  }

  fifo_writer_params: {
    fifo_width: [512],
    fifo_depth: [16],
  }

  data_reader_params:{
    tcdm_ports_num: [8],
    spatial_bounds: [[8]],
    spatial_dim: [1],
    element_width: [64],
  }

  data_writer_params:{
    tcdm_ports_num: [8],
    spatial_bounds: [[8]],
    spatial_dim: [1],
    element_width: [64],
  }

  stationarity: [0,0]
}
</code></pre></div>
Microarchitecturally, the streamer would look like the figure below:</p>
<p><img alt="image" src="https://github.com/KULeuven-MICAS/snitch_cluster/assets/26665295/0776d3b8-79d7-4a37-ba30-f60f8ca026f4" /></p>
<p>Some details include:
- Since there are 8 parallel ports for the input and output then the accelerator interfaces would have 512-bit channels.
- Each FIFO would have a depth of 16.
- There would be 8 TCDM ports in the TCDM interface for each input and output data movers.</p>
<p>In terms of CSR registers, the streamer would have the following:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">register name</th>
<th style="text-align: center;">register offset</th>
<th style="text-align: center;">type</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">temporal loop bound 0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">First temporal loop bound</td>
</tr>
<tr>
<td style="text-align: center;">temporal loop bound 1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">second temporal loop bound</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 0 for bound 0</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for loop bound 0 for input</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 1 for bound 0</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for loop bound 0 for output</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 0 for bound 1</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for loop bound 1 for input</td>
</tr>
<tr>
<td style="text-align: center;">temporal stride 1 for bound 1</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Temporal stride for loop bound 1 for output</td>
</tr>
<tr>
<td style="text-align: center;">spatial stride 0</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Spatial stride for input</td>
</tr>
<tr>
<td style="text-align: center;">spatial stride 1</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Spatial stride for output</td>
</tr>
<tr>
<td style="text-align: center;">base addr 0</td>
<td style="text-align: center;">8</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Base address for input</td>
</tr>
<tr>
<td style="text-align: center;">base addr 1</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Base address for output</td>
</tr>
<tr>
<td style="text-align: center;">start</td>
<td style="text-align: center;">10</td>
<td style="text-align: center;">RW</td>
<td style="text-align: left;">Start register to send configurations</td>
</tr>
<tr>
<td style="text-align: center;">perf. counter</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">RO</td>
<td style="text-align: left;">Performance counter indicating the number of cycles ran</td>
</tr>
</tbody>
</table>
<p>Because we now have two temporal loop bounds, the temporal stride registers are also doubled. We need two temporal strides, one for input and one for output, for each temporal loop bound. Therefore there are a total of 2 temporal strides for the first loop bound and another 2 temporal strides for the second loop bound.</p>
<p>Finally, the strided address generation that this streamer can do is:</p>
<div class="highlight"><pre><span></span><code>for(i = 0; i &lt; N; i++):
  for(j = 0; i &lt; M; j++):
    # Parfor equivalent
    parfor(k = 0; k &lt; 8; k++):
      temporal_address = temporal_stride_i*i + temporal_stride_j*j
      spatial_address = spatial_stride*k
      target_address = base_address + temporal_address + spatial_address
</code></pre></div>
<p>Finally, one can calculate the number of CSR registers of the streamer with:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Total number of temporal loop dimensions</span>
<span class="n">num_loop_dim</span> <span class="o">=</span> <span class="n">snax_streamer_cfg</span><span class="p">[</span><span class="s2">&quot;temporal_addrgen_unit_params&quot;</span><span class="p">][</span><span class="s2">&quot;loop_dim&quot;</span><span class="p">]</span>

<span class="c1"># Total number of data movers</span>
<span class="n">num_data_mover</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">snax_streamer_cfg</span><span class="p">[</span><span class="s2">&quot;data_reader_params&quot;</span><span class="p">][</span><span class="s2">&quot;tcdm_ports_num&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">snax_streamer_cfg</span><span class="p">[</span><span class="s2">&quot;data_writer_params&quot;</span><span class="p">][</span><span class="s2">&quot;tcdm_ports_num&quot;</span><span class="p">])</span>

<span class="c1"># This is essentially the total number of temporal loops and data movers combined</span>
<span class="n">num_dmove_x_loop_dim</span> <span class="o">=</span> <span class="n">num_data_mover</span> <span class="o">*</span> <span class="n">num_loop_dim</span>

<span class="c1"># Total number of spatial registers</span>
<span class="n">num_spatial_dim</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">snax_streamer_cfg</span><span class="p">[</span><span class="s2">&quot;data_reader_params&quot;</span><span class="p">][</span><span class="s2">&quot;spatial_dim&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">(</span><span class="n">snax_streamer_cfg</span><span class="p">[</span><span class="s2">&quot;data_writer_params&quot;</span><span class="p">][</span><span class="s2">&quot;spatial_dim&quot;</span><span class="p">])</span>

<span class="c1"># Total number of registers!</span>
<span class="c1"># The last two +1 are for the start register and the performance counter</span>
<span class="n">streamer_csr_num</span> <span class="o">=</span> <span class="n">num_loop_dim</span> <span class="o">+</span> <span class="n">num_dmove_x_loop_dim</span> <span class="o">+</span> <span class="n">num_data_mover</span> <span class="o">+</span> <span class="n">num_spatial_dim</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="csrman_design.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: 2. CSR Manager Design" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              2. CSR Manager Design
            </div>
          </div>
        </a>
      
      
        
        <a href="build_system.html" class="md-footer__link md-footer__link--next" aria-label="Next: 4. Building the System" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              4. Building the System
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.748e2769.min.js"></script>
      
    
  </body>
</html>